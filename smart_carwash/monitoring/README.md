# Smart Carwash Monitoring Setup

## üìä –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Smart Carwash –≤–∫–ª—é—á–∞–µ—Ç:

- **Grafana Loki** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–±–æ—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ (14 –¥–Ω–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è)
- **Prometheus** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **Grafana** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫
- **Promtail** - –∞–≥–µ–Ω—Ç —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤
- **Node Exporter** - —Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- **PostgreSQL Exporter** - –º–µ—Ç—Ä–∏–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üöÄ –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### 1. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
cd /home/artem/smart_carwash/smart_carwash
docker-compose up -d
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
docker-compose ps
```

### 3. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs -f

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose logs -f grafana
docker-compose logs -f prometheus
docker-compose logs -f loki
```

## üåê –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º

### Grafana (–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)
- **URL**: http://localhost:3000
- **–õ–æ–≥–∏–Ω**: admin
- **–ü–∞—Ä–æ–ª—å**: admin

### Prometheus (–ú–µ—Ç—Ä–∏–∫–∏)
- **URL**: http://localhost:9090

### Loki (–õ–æ–≥–∏)
- **URL**: http://localhost:3100

## üìà –î–∞—à–±–æ—Ä–¥—ã Grafana

### 1. Smart Carwash - Logs Dashboard
- –û–±–∑–æ—Ä –≤—Å–µ—Ö –ª–æ–≥–æ–≤ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—é (ERROR, WARN, INFO)
- –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
- –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ª–æ–≥–∞–º–∏

### 2. Smart Carwash - System Metrics
- CPU, Memory, Disk usage
- Network traffic
- Load average
- PostgreSQL connections

### 3. Smart Carwash - Application Metrics
- HTTP requests/sec
- Response times
- Error rates
- Session metrics
- Payment metrics
- Queue size

## üîç –†–∞–±–æ—Ç–∞ —Å –ª–æ–≥–∞–º–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã Loki

#### –ü–æ–∏—Å–∫ –ø–æ —Å–µ—Ä–≤–∏—Å—É
```
{job="backend"}
{job="frontend"}
{job="nginx"}
{job="postgres"}
```

#### –ü–æ–∏—Å–∫ –ø–æ —É—Ä–æ–≤–Ω—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```
{job="backend", level="error"}
{job="backend", level="warn"}
{job="backend", level="info"}
```

#### –ü–æ–∏—Å–∫ –ø–æ —Å—Ç–∞—Ç—É—Å—É HTTP
```
{job="nginx", status="200"}
{job="nginx", status=~"4..|5.."}
```

#### –ü–æ–∏—Å–∫ –ø–æ –º–µ—Ç–∞-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
```
{job="backend"} | json | user_id="12345"
{job="backend"} | json | session_id="abc-def"
{job="backend"} | json | payment_id="pay_123"
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```
# –°—á–µ—Ç—á–∏–∫–∏ –ª–æ–≥–æ–≤
sum(rate({job="backend"}[5m]))
sum(count_over_time({job="backend"}[1h]))

# –û—à–∏–±–∫–∏ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
sum(rate({job="backend", level="error"}[5m])) by (service)
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ Prometheus

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- `node_cpu_seconds_total` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
- `node_memory_MemTotal_bytes` - –æ–±—â–∞—è –ø–∞–º—è—Ç—å
- `node_filesystem_size_bytes` - —Ä–∞–∑–º–µ—Ä –¥–∏—Å–∫–∞
- `node_load1` - —Å—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `http_requests_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_request_duration_seconds` - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- `active_connections` - –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- `sessions_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π
- `payments_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–ª–∞—Ç–µ–∂–µ–π
- `queue_size` - —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏
- `errors_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

### –ú–µ—Ç—Ä–∏–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `pg_stat_database_numbackends` - –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î
- `pg_stat_database_tup_returned` - –≤–æ–∑–≤—Ä–∞—â–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
- `pg_stat_database_tup_fetched` - –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏

## üö® –ê–ª–µ—Ä—Ç—ã

–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∞–ª–µ—Ä—Ç—ã:

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã
- **HighCPUUsage** - CPU > 80% –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç
- **HighMemoryUsage** - –ø–∞–º—è—Ç—å > 85% –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç
- **HighDiskUsage** - –¥–∏—Å–∫ > 90% –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç
- **HighLoadAverage** - –Ω–∞–≥—Ä—É–∑–∫–∞ > 4 –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç

### –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **HighHTTPErrorRate** - –æ—à–∏–±–∫–∏ HTTP > 5% –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç
- **HighHTTPResponseTime** - –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ > 2 —Å–µ–∫ –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç
- **TooManyActiveConnections** - —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è > 100 –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç

### –ê–ª–µ—Ä—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **HighDatabaseConnections** - —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ë–î > 80 –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç
- **DatabaseDown** - –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –±–æ–ª–µ–µ 1 –º–∏–Ω—É—Ç—ã

### –ê–ª–µ—Ä—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
- **BackendDown** - backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –±–æ–ª–µ–µ 1 –º–∏–Ω—É—Ç—ã
- **FrontendDown** - frontend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –±–æ–ª–µ–µ 1 –º–∏–Ω—É—Ç—ã
- **NginxDown** - nginx –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –±–æ–ª–µ–µ 1 –º–∏–Ω—É—Ç—ã

### –ê–ª–µ—Ä—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **PrometheusDown** - Prometheus –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –±–æ–ª–µ–µ 1 –º–∏–Ω—É—Ç—ã
- **LokiDown** - Loki –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –±–æ–ª–µ–µ 1 –º–∏–Ω—É—Ç—ã
- **GrafanaDown** - Grafana –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –±–æ–ª–µ–µ 1 –º–∏–Ω—É—Ç—ã

### –ë–∏–∑–Ω–µ—Å-–∞–ª–µ—Ä—Ç—ã
- **HighQueueSize** - —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ > 10 –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç
- **HighErrorRate** - –æ—à–∏–±–∫–∏ > 0.1/—Å–µ–∫ –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç
- **NoSessionsCreated** - –Ω–µ—Ç —Å–µ—Å—Å–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
- **NoPaymentsProcessed** - –Ω–µ—Ç –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
```
monitoring/
‚îú‚îÄ‚îÄ loki-config.yml              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Loki
‚îú‚îÄ‚îÄ promtail-config.yml          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Promtail
‚îú‚îÄ‚îÄ prometheus.yml               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus
‚îú‚îÄ‚îÄ prometheus-rules/
‚îÇ   ‚îî‚îÄ‚îÄ alerts.yml               # –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤
‚îú‚îÄ‚îÄ grafana-datasources/
‚îÇ   ‚îî‚îÄ‚îÄ datasources.yml          # –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö Grafana
‚îî‚îÄ‚îÄ grafana-dashboards/
    ‚îú‚îÄ‚îÄ dashboards.yml           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤
    ‚îú‚îÄ‚îÄ logs-dashboard.json      # –î–∞—à–±–æ—Ä–¥ –ª–æ–≥–æ–≤
    ‚îú‚îÄ‚îÄ system-metrics-dashboard.json  # –î–∞—à–±–æ—Ä–¥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
    ‚îî‚îÄ‚îÄ app-metrics-dashboard.json     # –î–∞—à–±–æ—Ä–¥ –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

### –ü–æ—Ä—Ç—ã
- **Grafana**: 3000
- **Prometheus**: 9090
- **Loki**: 3100
- **Node Exporter**: 9100
- **PostgreSQL Exporter**: 9187

### Volumes
- `loki_data` - –¥–∞–Ω–Ω—ã–µ Loki (14 –¥–Ω–µ–π)
- `prometheus_data` - –¥–∞–Ω–Ω—ã–µ Prometheus (30 –¥–Ω–µ–π)
- `grafana_data` - –¥–∞–Ω–Ω—ã–µ Grafana

## üõ†Ô∏è Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—É—Å–∫–æ–º
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–æ–≤
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ª–æ–≥–∞–º–∏
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Promtail —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Loki –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Promtail

### –ü—Ä–æ–±–ª–µ–º—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ exporters —Ä–∞–±–æ—Ç–∞—é—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Prometheus

### –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–∞—à–±–æ—Ä–¥–∞–º–∏
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –¥–∞–Ω–Ω—ã—Ö
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞—à–±–æ—Ä–¥—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ Grafana

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ (JSON)
```go
logger.Info("User login", map[string]interface{}{
    "user_id": "12345",
    "ip": "192.168.1.1",
    "user_agent": "Mozilla/5.0...",
})
```

### –ú–µ—Ç–∞-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- `service` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
- `method` - HTTP –º–µ—Ç–æ–¥
- `path` - –ø—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞
- `status` - HTTP —Å—Ç–∞—Ç—É—Å
- `duration` - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `session_id` - ID —Å–µ—Å—Å–∏–∏
- `payment_id` - ID –ø–ª–∞—Ç–µ–∂–∞
- `error` - –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã: `docker-compose down`
2. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã: `docker-compose up -d`

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤
1. –û–±–Ω–æ–≤–∏—Ç–µ JSON —Ñ–∞–π–ª—ã –¥–∞—à–±–æ—Ä–¥–æ–≤
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Grafana: `docker-compose restart grafana`

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Grafana Loki Documentation](https://grafana.com/docs/loki/)
- [Prometheus Documentation](https://prometheus.io/docs/)
- [Grafana Documentation](https://grafana.com/docs/)
- [Promtail Documentation](https://grafana.com/docs/loki/latest/clients/promtail/)

