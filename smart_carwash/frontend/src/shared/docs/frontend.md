# Документация фронтенда

## Обзор

Фронтенд приложения умной автомойки построен на React с использованием функциональных компонентов и хуков. Приложение поддерживает несколько интерфейсов:

- **Telegram Mini App** - основной интерфейс для пользователей
- **Админский интерфейс** - управление системой
- **Кассирский интерфейс** - работа с очередью

## Структура проекта

```
src/
├── apps/
│   ├── admin/           # Админский интерфейс
│   ├── cashier/         # Кассирский интерфейс
│   ├── home/            # Главная страница
│   └── telegram/        # Telegram Mini App
├── shared/              # Общие компоненты и утилиты
│   ├── components/      # Переиспользуемые компоненты
│   ├── services/        # API сервисы
│   ├── hooks/           # Кастомные хуки
│   ├── utils/           # Утилиты
│   └── styles/          # Стили и темы
```

## Ключевые компоненты

### Админский интерфейс

#### UserManagement
- **Функция**: Управление пользователями системы
- **Особенности**: 
  - Модальное окно для просмотра деталей пользователя
  - Полезные ссылки для навигации между сущностями
  - Пагинация и фильтрация

#### SessionManagement
- **Функция**: Управление сессиями мойки
- **Особенности**:
  - Модальное окно с детальной информацией о сессии
  - Отображение дополнительных полей (with_chemistry, with_vacuum)
  - Полезные ссылки для навигации
  - Исправленные фильтры с правильными названиями полей API

#### WashBoxManagement
- **Функция**: Управление боксами мойки
- **Особенности**:
  - Исправленные JSON схемы (service_type вместо ServiceType)
  - Корректная обработка поля number как integer
  - Полезные ссылки для перехода к сессиям бокса

#### QueueStatus
- **Функция**: Мониторинг состояния очереди
- **Особенности**:
  - Отображение пользователей в очереди с их позициями
  - Полезные ссылки для перехода к деталям пользователей
  - Автоматическое обновление данных

### Общие компоненты

#### ApiService
- **Функция**: Централизованный сервис для работы с API
- **Особенности**:
  - Полный набор методов для всех сущностей
  - Обработка ошибок и логирование
  - Автоматическое добавление токенов авторизации
  - **Автоматическое преобразование camelCase в snake_case**

#### AuthService
- **Функция**: Управление авторизацией
- **Особенности**:
  - Проверка токенов
  - Перенаправление на соответствующие интерфейсы
  - Обработка истечения токенов

## Централизованное преобразование camelCase в snake_case

### Принцип работы

Все API запросы автоматически преобразуют camelCase ключи в snake_case перед отправкой на бэкенд:

```javascript
// В коде фронта используем camelCase
ApiService.createWashBox({
  boxNumber: 1,
  serviceType: 'wash',
  rentalTimeMinutes: 30
});

// На бэкенд отправляется snake_case
{
  "box_number": 1,
  "service_type": "wash", 
  "rental_time_minutes": 30
}
```

### Утилиты

- `toSnakeCase(obj)` - рекурсивно преобразует все ключи объекта в snake_case
- `toSnakeCaseQuery(filters)` - преобразует фильтры в query-строку
- `toSnakeCaseJSON(obj)` - преобразует объект в JSON с snake_case ключами

### Поддерживаемые типы данных

- Объекты (включая вложенные)
- Массивы
- Примитивы (строки, числа, булевы значения)
- null, undefined
- Date объекты (передаются как есть)

## Последние исправления

### Исправления в админском интерфейсе

1. **UserManagement**: Добавлено модальное окно для просмотра деталей пользователя
2. **SessionManagement**: Улучшено отображение деталей сессии с дополнительными полями
3. **WashBoxManagement**: Исправлены JSON схемы и обработка типов данных
4. **QueueStatus**: Добавлены полезные ссылки для навигации
5. **ApiService**: Исправлены названия полей в фильтрах
6. **Документация**: Обновлена с информацией о последних изменениях

### Исправления в API

1. **Фильтры**:
   - Исправлены названия полей в фильтрах сессий
   - Правильные имена полей для API (date_from, date_to, service_type)

2. **JSON схемы**:
   - Исправлены названия полей при создании боксов
   - Корректная обработка типов данных

3. **Централизованное преобразование**:
   - Создана утилита snakeCase для преобразования ключей
   - Все API методы автоматически используют snake_case
   - Поддержка рекурсивного преобразования вложенных объектов

## Стилизация

Приложение использует styled-components для стилизации. Основные принципы:

- **Темы**: Поддержка светлой и темной тем
- **Компоненты**: Переиспользуемые UI компоненты
- **Адаптивность**: Поддержка мобильных устройств

## Безопасность

- Проверка авторизации во всех защищенных компонентах
- Валидация данных на клиенте
- Безопасная обработка ошибок API

## Производительность

- Ленивая загрузка компонентов
- Оптимизированные запросы к API
- Кэширование данных где возможно

## Отладка

Для отладки авторизации добавлен компонент AuthDebug, который показывает:
- Текущий токен
- Статус авторизации
- Информацию о пользователе

## Навигация

Реализована система полезных ссылок между различными сущностями:
- Переход от пользователя к его сессиям
- Переход от сессии к пользователю и боксу
- Переход от бокса к его сессиям
- Переход от очереди к деталям пользователей
