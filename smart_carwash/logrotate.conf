# Конфигурация ротации логов для Smart Carwash

# Docker контейнеры логи
/var/lib/docker/containers/*/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0644 root root
    postrotate
        docker kill -s USR1 $(docker ps -q) 2>/dev/null || true
    endscript
}

# Системные логи
/var/log/syslog {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0644 syslog adm
    postrotate
        systemctl reload rsyslog >/dev/null 2>&1 || true
    endscript
}

/var/log/auth.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0644 syslog adm
    postrotate
        systemctl reload rsyslog >/dev/null 2>&1 || true
    endscript
}

# Логи приложения (если есть)
/var/log/smart_carwash/*.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 0644 root root
    postrotate
        # Перезапуск сервисов при необходимости
        systemctl reload smart_carwash >/dev/null 2>&1 || true
    endscript
}

# Nginx логи
/var/log/nginx/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0644 www-data adm
    postrotate
        systemctl reload nginx >/dev/null 2>&1 || true
    endscript
}

# PostgreSQL логи
/var/log/postgresql/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0644 postgres postgres
    postrotate
        systemctl reload postgresql >/dev/null 2>&1 || true
    endscript
}
